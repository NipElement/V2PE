please install petrel_client
args.rope_pos_id_version='default'
args=Namespace(checkpoint='pretrained/InternVL2_5-8B', task='counting-image-test', outputs_dir='eval_logs/mmniah/internvl2_5_8b/counting-image-test', num_gpus_per_rank=8, image_folder='', question_file='', rope_pos_id_version='default', rope_pos_id_stride=None)
Start evaluation on task counting-image-test
Rank: 0, Local Rank: 0, Using GPUs: [0, 1, 2, 3, 4, 5, 6, 7]
Distributed initialized: Rank 0, Local Rank 0, GPU List: [0, 1, 2, 3, 4, 5, 6, 7]
language_model.model.layers.0 1
language_model.model.layers.1 1
language_model.model.layers.2 1
language_model.model.layers.3 1
language_model.model.layers.4 1
language_model.model.layers.5 2
language_model.model.layers.6 2
language_model.model.layers.7 2
language_model.model.layers.8 2
language_model.model.layers.9 2
language_model.model.layers.10 3
language_model.model.layers.11 3
language_model.model.layers.12 3
language_model.model.layers.13 3
language_model.model.layers.14 3
language_model.model.layers.15 4
language_model.model.layers.16 4
language_model.model.layers.17 4
language_model.model.layers.18 4
language_model.model.layers.19 4
language_model.model.layers.20 5
language_model.model.layers.21 5
language_model.model.layers.22 5
language_model.model.layers.23 5
language_model.model.layers.24 5
language_model.model.layers.25 6
language_model.model.layers.26 6
language_model.model.layers.27 6
language_model.model.layers.28 6
language_model.model.layers.29 6
language_model.model.layers.30 7
language_model.model.layers.31 7
vision_model.encoder.layers.0 0
vision_model.encoder.layers.1 0
vision_model.encoder.layers.2 0
vision_model.encoder.layers.3 0
vision_model.encoder.layers.4 0
vision_model.encoder.layers.5 0
vision_model.encoder.layers.6 0
vision_model.encoder.layers.7 0
vision_model.encoder.layers.8 0
vision_model.encoder.layers.9 0
vision_model.encoder.layers.10 0
vision_model.encoder.layers.11 0
vision_model.encoder.layers.12 0
vision_model.encoder.layers.13 0
vision_model.encoder.layers.14 0
vision_model.encoder.layers.15 0
vision_model.encoder.layers.16 0
vision_model.encoder.layers.17 0
vision_model.encoder.layers.18 0
vision_model.encoder.layers.19 0
vision_model.encoder.layers.20 0
vision_model.encoder.layers.21 0
vision_model.encoder.layers.22 0
vision_model.encoder.layers.23 0
vision_model.embeddings 0
local_posid.weight 0
mlp1 0
language_model.model.tok_embeddings 1
language_model.model.norm 7
language_model.output 7
language_model.model.embed_tokens 1
language_model.lm_head 7
The argument `trust_remote_code` is to be used with Auto classes. It has no effect here and is ignored.
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
scaling_type='dynamic', scaling_factor=2.0, True
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:06<00:18,  6.03s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:10<00:10,  5.06s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:15<00:05,  5.17s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:16<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:16<00:00,  4.09s/it]
Rank [0] Begin to eval model pretrained/InternVL2_5-8B on task counting-image-test, devices: {device(type='cuda', index=0), device(type='cuda', index=1), device(type='cuda', index=2), device(type='cuda', index=3), device(type='cuda', index=4), device(type='cuda', index=5), device(type='cuda', index=6), device(type='cuda', index=7)}
t-20250116054552-mzx4k-worker-0:153685:153685 [0] NCCL INFO Bootstrap : Using eth1:192.168.0.42<0>
t-20250116054552-mzx4k-worker-0:153685:153685 [0] NCCL INFO NET/Plugin: Failed to find ncclCollNetPlugin_v6 symbol.
t-20250116054552-mzx4k-worker-0:153685:153685 [0] NCCL INFO NET/Plugin: Failed to find ncclCollNetPlugin symbol (v4 or v5).
t-20250116054552-mzx4k-worker-0:153685:153685 [0] NCCL INFO cudaDriverVersion 11080
NCCL version 2.14.3+cuda11.7
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Plugin Path : /usr/local/nccl-rdma-sharp-plugins/lib/libnccl-net.so
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO P2P plugin IBext
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO NCCL_IB_PCI_RELAXED_ORDERING set by environment to 1.
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO NET/IB : Using [0]mlx5_1:1/RoCE [1]mlx5_2:1/RoCE [2]mlx5_3:1/RoCE [3]mlx5_4:1/RoCE [RO]; OOB eth1:192.168.0.42<0>
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Using network IBext
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Setting affinity for GPU 0 to ffffffff,00000000,ffffffff
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 00/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 01/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 02/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 03/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 04/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 05/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 06/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 07/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 08/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 09/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 10/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 11/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 12/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 13/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 14/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 15/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 16/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 17/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 18/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 19/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 20/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 21/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 22/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 23/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 24/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 25/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 26/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 27/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 28/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 29/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 30/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Channel 31/32 :    0
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Connected all rings
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO Connected all trees
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO 32 coll channels, 32 p2p channels, 32 p2p channels per peer
t-20250116054552-mzx4k-worker-0:153685:153859 [0] NCCL INFO comm 0xdb7e6150 rank 0 nranks 1 cudaDev 0 busId 40000 - Init COMPLETE
USE rope_pos_id_stride=None
Rank 0 len(skip_idx)=2713
Processing InternVL2_5-8B_counting-image-test.jsonl:   0%|          | 0/2713 [00:00<?, ?it/s]Processing InternVL2_5-8B_counting-image-test.jsonl: 100%|██████████| 2713/2713 [00:00<00:00, 2081043.66it/s]
[2025-01-17 00:11:31] Rank 0 Finish
cat eval_logs/mmniah/internvl2_5_8b/counting-image-test/temp_InternVL2_5-8B_counting-image-test/* >  eval_logs/mmniah/internvl2_5_8b/counting-image-test/InternVL2_5-8B_counting-image-test.jsonl
python eval/mm_niah/calculate_scores.py --outputs-dir eval_logs/mmniah/internvl2_5_8b/counting-image-test
results on test split of InternVL2_5-8B are save in eval_logs/mmniah/internvl2_5_8b/counting-image-test/results/InternVL2_5-8B/scores_test.json
t-20250116054552-mzx4k-worker-0:153685:153864 [0] NCCL INFO [Service thread] Connection closed by localRank 0
t-20250116054552-mzx4k-worker-0:153685:153685 [0] NCCL INFO comm 0xdb7e6150 rank 0 nranks 1 cudaDev 0 busId 40000 - Abort COMPLETE
